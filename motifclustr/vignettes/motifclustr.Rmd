---
title: "Using the `motifclustr` package"
author: "William George Underwood"
date: "`r Sys.Date()`"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Using the `motifclustr` package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
header-includes:
  - \usepackage{tikz}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
set.seed(0)
```

## Introduction

This vignette demonstrates how to use the `motifclustr` package for motif-based
spectral clustering of weighted directed networks.
The functionality of the `motifclustr` package falls into two main categories:

- Building motif adjacency matrices (MAMs)
- Using MAMs for spectral clustering

This vignette comprehensibly demonstrates both of these functionalities,
showcasing the full capability of the `motifclustr` package.

### Loading the package

The package can be loaded with
```{r}
library(motifclustr)
```

TODO are these really necessary
A few other packages are also required for this vignette.
```{r}
#library(igraph)
```

## Building motif adjacency matrices

The main novelty in the `motifclustr` package is its ability to
build a wide variety of MAMs, and to do so quickly.
There are several options to consider when building a MAM,
and these options are covered in this section.

### An example network

In order to demonstrate the construction of MAMs,
we first need a small weighted directed network $\mathcal{G}$ to use as an example.
Note that throughout this package we represent networks by their
weighted directed adjacency matrices (possibly in sparse form).
This means that for use alongside packages such as `igraph`,
one must manually convert between adjacency matrices and
`igraph` objects.

```{r}
adj_mat = matrix(c(
  0, 1, 0, 0,
  0, 0, 2, 3,
  0, 4, 0, 0,
  5, 0, 6, 0
), byrow=TRUE, nrow=4)
```

TODO plot network
\begin{tikzpicture}
\end{tikzpicture}

The `build_motif_adjacency_matrix` function is the main workhorse
for building MAMs with `motifclustr`.
Let's use it to build a MAM for our example network $\mathcal{G}$.
First we must choose a motif to look for; let's use the
3-cycle motif $\mathcal{M}_1$.

### Basic motif adjacency matrix construction

```{r}
mam = build_motif_adjacency_matrix(adj_mat, "M1")
prmatrix(mam)
```

Note that all the entries are zero except for entries
$(1,2)$,
$(1,4)$,
$(4,1)$,
and
$(4,2)$.
This is because vertices 1, 2 and 4 form an exact copy of
the motif $\mathcal{M}_1$ in the network $\mathcal{G}$.

### Functional and structural motif adjacency matrices

Looking at our example network again,
you might notice that there is seemingly another instance
of the motif $\mathcal{M}_1$
in our network $\mathcal{G}$,
on the vertices 2, 3 and 4,
albeit with an extra edge from 2 to 3.
The reason for this is that we instructed
`build_motif_adjacency_matrix`
to look for *structural* motif instances (this is the default).
Structural instances require an exact match, with no extra edges.
If we want to also include instances which may have extra edges present,
we can instead use functional motif instances:

```{r}
mam = build_motif_adjacency_matrix(adj_mat, "M1", motif_type = "func")
prmatrix(mam)
```
This time we also pick up the 3-cycle vertices 2, 3 and 4.
Vertices 2 and 4 therefore occur in two different instances
of the motif, and so their motif adjacency matrix entries are equal
to two.
