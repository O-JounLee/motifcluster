context("Motif adjacency")

# build_motif_adjacency_matrix
# test against igraph too?

test_that("build_motif_adjacency_matrix returns correct unweighted functional matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  2,  2,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    1,  2,  0,  0,  0,  2,  0,  0,  1,  1,  0,  0,
    0,  2,  2,  0,  2,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  1,  1,  0,  1,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  3,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  3,  0,  0,  0,  1,  0,  0,
    0,  3,  1,  0,  3,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  2,  0,  6,  8,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  7,  0,  0,  0,  1,  0,  0,
    0,  8,  2,  0,  7,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  6,  7,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0,
    0,  7,  1,  0,  6,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M5 = drop0(matrix(c(
    0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0,  8,  9,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  5,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    2,  8,  0,  0,  0,  7,  0,  0,  1,  2,  0,  0,
    0,  9,  5,  0,  7,  0,  2,  0,  0,  1,  0,  0,
    0,  0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  3,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  4,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  1,  0,  3,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  4,  1,  0,  5,  2,  0,  0,  1,  1,  0,  0,
    4,  0,  4,  0,  8,  7,  0,  0,  1,  1,  1,  0,
    1,  4,  0,  1,  2,  5,  3,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  3,  1,  0,  0,  0,  0,
    5,  8,  2,  0,  0,  8,  0,  0,  4,  4,  1,  0,
    2,  7,  5,  1,  8,  0,  3,  1,  1,  1,  3,  0,
    0,  0,  3,  3,  0,  3,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  5,  0, 11, 14,  1,  0,  1,  2,  1,  0,
    0,  5,  0,  0,  3, 10,  5,  1,  0,  1,  2,  1,
    0,  0,  0,  0,  0,  0,  3,  1,  0,  0,  1,  1,
    3, 11,  3,  0,  0, 15,  1,  0,  3,  5,  1,  0,
    2, 14, 10,  0, 15,  0,  9,  1,  2,  7,  7,  1,
    0,  1,  5,  3,  1,  9,  0,  5,  0,  0,  6,  4,
    0,  0,  1,  1,  0,  1,  5,  0,  0,  0,  1,  1,
    0,  1,  0,  0,  3,  2,  0,  0,  0,  2,  0,  0,
    0,  2,  1,  0,  5,  7,  0,  0,  2,  0,  1,  0,
    0,  1,  2,  1,  1,  7,  6,  1,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  4,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  3,  0,  4,  7,  2,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  1,  6,  3,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  1,  0,  0,  6,  1,  0,  1,  2,  0,  0,
    0,  7,  6,  0,  6,  0,  5,  0,  0,  4,  0,  0,
    0,  2,  3,  0,  1,  5,  0,  2,  0,  1,  2,  2,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  2,  4,  1,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  4,  0, 11, 11,  0,  0,  1,  1,  1,  0,
    0,  4,  0,  0,  3,  6,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    3, 11,  3,  0,  0, 12,  0,  0,  2,  2,  1,  0,
    2, 11,  6,  0, 12,  0,  1,  1,  1,  1,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  3,  0,  6, 11,  1,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  2,  8,  2,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  2,  0,  0, 10,  1,  0,  0,  1,  0,  0,
    0, 11,  8,  0, 10,  0,  4,  0,  0,  3,  0,  0,
    0,  1,  2,  0,  1,  4,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  1,  0,  0,  4,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  2,  2,  0,  0,  1,  0,  0,
    0,  1,  0,  0,  1,  0,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  0,  1,  1,  0,  1,  1,  0,  0,
    0,  2,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  1,  1,  0,  1,  2,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  1,  1,  0,  0,  1,  1,  1,  0,
    1,  1,  0,  1,  2,  2,  0,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0,
    1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    2,  1,  2,  1,  1,  0,  0,  1,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "unweighted", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "unweighted", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "unweighted", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "unweighted", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

test_that("build_motif_adjacency_matrix returns correct unweighted structural matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M5 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  1,  1,  0,  2,  0,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,
    2,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  2,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  1,  2,  1,  1,
    0,  0,  2,  2,  0,  1,  0,  0,  0,  0,  2,  3,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  2,  0,  0,  1,  0,  1,  0,
    0,  0,  1,  1,  0,  1,  2,  0,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  0,  1,  0,  0,  0,  1,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  3,  2,  0,  0,  1,  1,  1,  0,
    0,  1,  0,  0,  1,  1,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    1,  3,  1,  0,  0,  3,  0,  0,  2,  1,  1,  0,
    2,  2,  1,  0,  3,  0,  1,  1,  1,  0,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  0,  2,  0,  0,  2,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  0,  1,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "unweighted", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "unweighted", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "unweighted", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "unweighted", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_densemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_densemethod", motifs[i]))
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_sparsemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_sparsemethod", motifs[i]))
  }

})

test_that("build_motif_adjacency_matrix returns correct mean-weighted functional matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  2,  0,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0, 19, 11,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 12,  0,  0,  0,  0,  0,
    4, 11,  0,  0,  0, 27,  0,  0, 18, 19,  0,  0,
    0, 15, 19,  0, 27,  0, 15,  0,  0, 20, 21,  0,
    0,  0, 11, 12,  0, 15,  0, 33,  0,  0, 22, 23,
    0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 18,  0,  0,  0,  0, 24,  0,  0,
    0,  0,  0,  0, 19, 20,  0,  0, 24,  0,  0,  0,
    0,  0,  0,  0,  0, 21, 22,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 23,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 19,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 11,  0,  0,  0, 27,  0,  0,  0,  0,  0,  0,
    0, 15, 19,  0, 27,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 20,  0, 53, 73,  0,  0,  0,  0,  0,  0,
    0, 20,  0,  0,  0, 20,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0,  0,105,  0,  0,  0, 52,  0,  0,
    0, 73, 20,  0,105,  0, 58,  0,  0, 52, 58,  0,
    0,  0,  0,  0,  0, 58,  0,  0,  0,  0, 58,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 52, 52,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 58, 58,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 57,  0,212,269,  0,  0,  0,  0,  0,  0,
    0, 57,  0,  0,  0, 57,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,212,  0,  0,  0,278,  0,  0,  0, 66,  0,  0,
    0,269, 57,  0,278,  0,  0,  0,  0, 66,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 66, 66,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 37,  0,265,302,  0,  0,  0,  0,  0,  0,
    0, 37,  0,  0,  0, 37,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,265,  0,  0,  0,265,  0,  0,  0,  0,  0,  0,
    0,302, 37,  0,265,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 5

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 53, 53,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0,  0, 53,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0, 53,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 6

  ans$M5 = drop0(matrix(c(
    0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0,  8,  9,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  5,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    2,  8,  0,  0,  0,  7,  0,  0,  1,  2,  0,  0,
    0,  9,  5,  0,  7,  0,  2,  0,  0,  1,  0,  0,
    0,  0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  3,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  4,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  1,  0,  3,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  4,  1,  0,  5,  2,  0,  0,  1,  1,  0,  0,
    4,  0,  4,  0,  8,  7,  0,  0,  1,  1,  1,  0,
    1,  4,  0,  1,  2,  5,  3,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  3,  1,  0,  0,  0,  0,
    5,  8,  2,  0,  0,  8,  0,  0,  4,  4,  1,  0,
    2,  7,  5,  1,  8,  0,  3,  1,  1,  1,  3,  0,
    0,  0,  3,  3,  0,  3,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  5,  0, 11, 14,  1,  0,  1,  2,  1,  0,
    0,  5,  0,  0,  3, 10,  5,  1,  0,  1,  2,  1,
    0,  0,  0,  0,  0,  0,  3,  1,  0,  0,  1,  1,
    3, 11,  3,  0,  0, 15,  1,  0,  3,  5,  1,  0,
    2, 14, 10,  0, 15,  0,  9,  1,  2,  7,  7,  1,
    0,  1,  5,  3,  1,  9,  0,  5,  0,  0,  6,  4,
    0,  0,  1,  1,  0,  1,  5,  0,  0,  0,  1,  1,
    0,  1,  0,  0,  3,  2,  0,  0,  0,  2,  0,  0,
    0,  2,  1,  0,  5,  7,  0,  0,  2,  0,  1,  0,
    0,  1,  2,  1,  1,  7,  6,  1,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  4,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  3,  0,  4,  7,  2,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  1,  6,  3,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  1,  0,  0,  6,  1,  0,  1,  2,  0,  0,
    0,  7,  6,  0,  6,  0,  5,  0,  0,  4,  0,  0,
    0,  2,  3,  0,  1,  5,  0,  2,  0,  1,  2,  2,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  2,  4,  1,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  4,  0, 11, 11,  0,  0,  1,  1,  1,  0,
    0,  4,  0,  0,  3,  6,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    3, 11,  3,  0,  0, 12,  0,  0,  2,  2,  1,  0,
    2, 11,  6,  0, 12,  0,  1,  1,  1,  1,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  3,  0,  6, 11,  1,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  2,  8,  2,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  2,  0,  0, 10,  1,  0,  0,  1,  0,  0,
    0, 11,  8,  0, 10,  0,  4,  0,  0,  3,  0,  0,
    0,  1,  2,  0,  1,  4,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  1,  0,  0,  4,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  2,  2,  0,  0,  1,  0,  0,
    0,  1,  0,  0,  1,  0,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  0,  1,  1,  0,  1,  1,  0,  0,
    0,  2,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  1,  1,  0,  1,  2,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  1,  1,  0,  0,  1,  1,  1,  0,
    1,  1,  0,  1,  2,  2,  0,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0,
    1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    2,  1,  2,  1,  1,  0,  0,  1,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  #for(i in 1:length(motifs)){
  for(i in 6){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "mean", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "mean", "dense")
    #MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      #adj_mat_dense, motifs[i], "func", "mean", "sparse")
    #MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      #adj_mat_sparse, motifs[i], "func", "mean", "sparse")

    print(motifs[i])
    print(6*MAM_densematrix_densemethod)
    print(6*ans[[motifs[i]]])

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    #expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    #expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

# get_largest_component

test_that("get_largest_component returns correct indices", {

  adj_mat_dense = matrix(c(
    0,0,0,0,0,
    0,0,1,0,0,
    0,0,0,0,2,
    3,0,0,0,0,
    0,4,0,0,0
  ), nrow=5, byrow=TRUE)
  adj_mat_sparse = drop0(adj_mat_dense)

  ans = c(2,3,5)

  expect_equal(get_largest_component(adj_mat_dense), ans)
  expect_equal(get_largest_component(adj_mat_sparse), ans)
})

# drop0_killdiag

test_that("drop0_killdiag returns correct matrix", {

  adj_mat_dense = matrix(-1:7, nrow=3)
  adj_mat_sparse = drop0(adj_mat_dense)

  ans = drop0(matrix(c(0,0,1,2,0,4,5,6,0), nrow=3))

  expect_equal(drop0_killdiag(adj_mat_dense), ans)
  expect_equal(drop0_killdiag(adj_mat_sparse), ans)
})
