context("Motif adjacency")

# build_motif_adjacency_matrix
# test against igraph too?

test_that("build_motif_adjacency_matrix returns correct unweighted functional matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  2,  2,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    1,  2,  0,  0,  0,  2,  0,  0,  1,  1,  0,  0,
    0,  2,  2,  0,  2,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  1,  1,  0,  1,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  3,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  3,  0,  0,  0,  1,  0,  0,
    0,  3,  1,  0,  3,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  2,  0,  6,  8,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  7,  0,  0,  0,  1,  0,  0,
    0,  8,  2,  0,  7,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  6,  7,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0,
    0,  7,  1,  0,  6,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M5 = drop0(matrix(c(
    0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0,  8,  9,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  5,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    2,  8,  0,  0,  0,  7,  0,  0,  1,  2,  0,  0,
    0,  9,  5,  0,  7,  0,  2,  0,  0,  1,  0,  0,
    0,  0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  3,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  4,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  1,  0,  3,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  4,  1,  0,  5,  2,  0,  0,  1,  1,  0,  0,
    4,  0,  4,  0,  8,  7,  0,  0,  1,  1,  1,  0,
    1,  4,  0,  1,  2,  5,  3,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  3,  1,  0,  0,  0,  0,
    5,  8,  2,  0,  0,  8,  0,  0,  4,  4,  1,  0,
    2,  7,  5,  1,  8,  0,  3,  1,  1,  1,  3,  0,
    0,  0,  3,  3,  0,  3,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  5,  0, 11, 14,  1,  0,  1,  2,  1,  0,
    0,  5,  0,  0,  3, 10,  5,  1,  0,  1,  2,  1,
    0,  0,  0,  0,  0,  0,  3,  1,  0,  0,  1,  1,
    3, 11,  3,  0,  0, 15,  1,  0,  3,  5,  1,  0,
    2, 14, 10,  0, 15,  0,  9,  1,  2,  7,  7,  1,
    0,  1,  5,  3,  1,  9,  0,  5,  0,  0,  6,  4,
    0,  0,  1,  1,  0,  1,  5,  0,  0,  0,  1,  1,
    0,  1,  0,  0,  3,  2,  0,  0,  0,  2,  0,  0,
    0,  2,  1,  0,  5,  7,  0,  0,  2,  0,  1,  0,
    0,  1,  2,  1,  1,  7,  6,  1,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  4,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  3,  0,  4,  7,  2,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  1,  6,  3,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  1,  0,  0,  6,  1,  0,  1,  2,  0,  0,
    0,  7,  6,  0,  6,  0,  5,  0,  0,  4,  0,  0,
    0,  2,  3,  0,  1,  5,  0,  2,  0,  1,  2,  2,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  2,  4,  1,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  4,  0, 11, 11,  0,  0,  1,  1,  1,  0,
    0,  4,  0,  0,  3,  6,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    3, 11,  3,  0,  0, 12,  0,  0,  2,  2,  1,  0,
    2, 11,  6,  0, 12,  0,  1,  1,  1,  1,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  3,  0,  6, 11,  1,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  2,  8,  2,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  2,  0,  0, 10,  1,  0,  0,  1,  0,  0,
    0, 11,  8,  0, 10,  0,  4,  0,  0,  3,  0,  0,
    0,  1,  2,  0,  1,  4,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  1,  0,  0,  4,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  2,  2,  0,  0,  1,  0,  0,
    0,  1,  0,  0,  1,  0,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  0,  1,  1,  0,  1,  1,  0,  0,
    0,  2,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  1,  1,  0,  1,  2,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  1,  1,  0,  0,  1,  1,  1,  0,
    1,  1,  0,  1,  2,  2,  0,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0,
    1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    2,  1,  2,  1,  1,  0,  0,  1,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "unweighted", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "unweighted", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "unweighted", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "unweighted", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

test_that("build_motif_adjacency_matrix returns correct unweighted structural matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M5 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  1,  1,  0,  2,  0,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,
    2,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  2,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  1,  2,  1,  1,
    0,  0,  2,  2,  0,  1,  0,  0,  0,  0,  2,  3,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  2,  0,  0,  1,  0,  1,  0,
    0,  0,  1,  1,  0,  1,  2,  0,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  0,  1,  0,  0,  0,  1,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  3,  2,  0,  0,  1,  1,  1,  0,
    0,  1,  0,  0,  1,  1,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    1,  3,  1,  0,  0,  3,  0,  0,  2,  1,  1,  0,
    2,  2,  1,  0,  3,  0,  1,  1,  1,  0,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  0,  2,  0,  0,  2,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  0,  1,  0,  0,  0,  0,  0,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "unweighted", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "unweighted", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "unweighted", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "unweighted", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_densemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_densemethod", motifs[i]))
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_sparsemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_sparsemethod", motifs[i]))
  }

})

test_that("build_motif_adjacency_matrix returns correct mean-weighted functional matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  2,  0,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0, 19, 11,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 12,  0,  0,  0,  0,  0,
    4, 11,  0,  0,  0, 27,  0,  0, 18, 19,  0,  0,
    0, 15, 19,  0, 27,  0, 15,  0,  0, 20, 21,  0,
    0,  0, 11, 12,  0, 15,  0, 33,  0,  0, 22, 23,
    0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 18,  0,  0,  0,  0, 24,  0,  0,
    0,  0,  0,  0, 19, 20,  0,  0, 24,  0,  0,  0,
    0,  0,  0,  0,  0, 21, 22,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 23,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 19,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 11,  0,  0,  0, 27,  0,  0,  0,  0,  0,  0,
    0, 15, 19,  0, 27,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 20,  0, 53, 73,  0,  0,  0,  0,  0,  0,
    0, 20,  0,  0,  0, 20,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0,  0,105,  0,  0,  0, 52,  0,  0,
    0, 73, 20,  0,105,  0, 58,  0,  0, 52, 58,  0,
    0,  0,  0,  0,  0, 58,  0,  0,  0,  0, 58,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 52, 52,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 58, 58,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 57,  0,212,269,  0,  0,  0,  0,  0,  0,
    0, 57,  0,  0,  0, 57,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,212,  0,  0,  0,278,  0,  0,  0, 66,  0,  0,
    0,269, 57,  0,278,  0,  0,  0,  0, 66,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 66, 66,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 37,  0,265,302,  0,  0,  0,  0,  0,  0,
    0, 37,  0,  0,  0, 37,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,265,  0,  0,  0,265,  0,  0,  0,  0,  0,  0,
    0,302, 37,  0,265,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 5

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 53, 53,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0,  0, 53,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0, 53,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 6

  ans$M5 = drop0(matrix(c(
    0, 23,  0,  0, 23,  0,  0,  0,  0,  0,  0,  0,
   23,  0, 60,  0,182,219,  0,  0,  0,  0,  0,  0,
    0, 60,  0,  0,  0,131, 71,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   23,182,  0,  0,  0,212,  0,  0, 61,114,  0,  0,
    0,219,131,  0,212,  0, 71,  0,  0, 53,  0,  0,
    0,  0, 71,  0,  0, 71,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 61,  0,  0,  0,  0, 61,  0,  0,
    0,  0,  0,  0,114, 53,  0,  0, 61,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 30,  0,106,136,  0,  0,  0,  0,  0,  0,
    0, 30,  0,  0,  0, 75, 45,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,106,  0,  0,  0,106,  0,  0,  0,  0,  0,  0,
    0,136, 75,  0,106,  0, 45,  0,  0,  0,  0,  0,
    0,  0, 45,  0,  0, 45,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M7 = drop0(matrix(c(
    0, 17,  0,  0, 17,  0,  0,  0,  0,  0,  0,  0,
   17,  0, 27,  0,123,133,  0,  0,  0,  0,  0,  0,
    0, 27,  0,  0,  0, 27,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   17,123,  0,  0,  0,106,  0,  0,  0,  0,  0,  0,
    0,133, 27,  0,106,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M8 = drop0(matrix(c(
    0, 32,  5,  0, 80, 28,  0,  0, 22, 23,  0,  0,
   32,  0, 41,  0,126,118,  0,  0, 23, 24, 28,  0,
    5, 41,  0, 23, 31,105, 77, 28,  0,  0, 30,  0,
    0,  0, 23,  0,  0, 27, 79, 29,  0,  0,  0,  0,
   80,126, 31,  0,  0,192,  0,  0,114,117, 34,  0,
   28,118,105, 27,192,  0, 85, 32, 32, 33, 92,  0,
    0,  0, 77, 79,  0, 85,  0, 89,  0,  0,  0,  0,
    0,  0, 28, 29,  0, 32, 89,  0,  0,  0,  0,  0,
   22, 23,  0,  0,114, 32,  0,  0,  0, 37,  0,  0,
   23, 24,  0,  0,117, 33,  0,  0, 37,  0,  0,  0,
    0, 28, 30,  0, 34, 92,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M9 = drop0(matrix(c(
    0, 26,  0,  0, 34, 26,  0,  0,  0,  0,  0,  0,
   26,  0, 65,  0,180,250, 22,  0, 24, 52, 29,  0,
    0, 65,  0,  0, 54,208,139, 27,  0, 29, 64, 34,
    0,  0,  0,  0,  0,  0, 97, 28,  0,  0, 34, 35,
   34,180, 54,  0,  0,367, 28,  0, 97,171, 35,  0,
   26,250,208,  0,367,  0,280, 31, 75,245,252, 38,
    0, 22,139, 97, 28,280,  0,165,  0,  0,222,147,
    0,  0, 27, 28,  0, 31,165,  0,  0,  0, 39, 40,
    0, 24,  0,  0, 97, 75,  0,  0,  0, 86,  0,  0,
    0, 52, 29,  0,171,245,  0,  0, 86,  0, 41,  0,
    0, 29, 64, 34, 35,252,222, 39,  0, 41,  0,  0,
    0,  0, 34, 35,  0, 38,147, 40,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M10 = drop0(matrix(c(
    0,  6,  0,  0,  6,  0,  0,  0,  0,  0,  0,  0,
    6,  0, 44,  0, 59,134, 37,  0,  0, 28,  0,  0,
    0, 44,  0,  0, 24,129, 59,  0,  0, 30,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    6, 59, 24,  0,  0,140, 29,  0, 43, 77,  0,  0,
    0,134,129,  0,140,  0,132,  0,  0,127,  0,  0,
    0, 37, 59,  0, 29,132,  0, 77,  0, 35, 83, 84,
    0,  0,  0,  0,  0,  0, 77,  0,  0,  0, 38, 39,
    0,  0,  0,  0, 43,  0,  0,  0,  0, 43,  0,  0,
    0, 28, 30,  0, 77,127, 35,  0, 43,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 83, 38,  0,  0,  0, 45,
    0,  0,  0,  0,  0,  0, 84, 39,  0,  0, 45,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M11 = drop0(matrix(c(
    0, 45,  0,  0, 59, 48,  0,  0,  0,  0,  0,  0,
   45,  0, 82,  0,260,280,  0,  0, 29, 30, 36,  0,
    0, 82,  0,  0, 82,176, 44, 44,  0,  0, 40,  0,
    0,  0,  0,  0,  0,  0, 45, 45,  0,  0,  0,  0,
   59,260, 82,  0,  0,397,  0,  0, 74, 76, 48,  0,
   48,280,176,  0,397,  0, 48, 48, 45, 46,124,  0,
    0,  0, 44, 45,  0, 48,  0,137,  0,  0,  0,  0,
    0,  0, 44, 45,  0, 48,137,  0,  0,  0,  0,  0,
    0, 29,  0,  0, 74, 45,  0,  0,  0,  0,  0,  0,
    0, 30,  0,  0, 76, 46,  0,  0,  0,  0,  0,  0,
    0, 36, 40,  0, 48,124,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 74,  0,159,298, 30,  0,  0, 35,  0,  0,
    0, 74,  0,  0, 70,247, 64,  0,  0, 39,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,159, 70,  0,  0,318, 42,  0,  0, 47,  0,  0,
    0,298,247,  0,318,  0,136,  0,  0,121,  0,  0,
    0, 30, 64,  0, 42,136,  0,111,  0,  0, 55, 56,
    0,  0,  0,  0,  0,  0,111,  0,  0,  0, 55, 56,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 35, 39,  0, 47,121,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 55, 55,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 56, 56,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 34,  0,106,140,  0,  0,  0,  0,  0,  0,
    0, 34,  0,  0, 46, 80,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,106, 46,  0,  0,152,  0,  0,  0,  0,  0,  0,
    0,140, 80,  0,152,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 18,  0, 28, 31, 37,  0,  0, 28,  0,  0,
    0, 18,  0,  0, 24,  0, 25,  0,  0, 30,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 28, 24,  0,  0, 12, 29,  0, 43, 34,  0,  0,
    0, 31,  0,  0, 12,  0, 20,  0,  0,  0,  0,  0,
    0, 37, 25,  0, 29, 20,  0,  0,  0, 35,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 38, 39,
    0,  0,  0,  0, 43,  0,  0,  0,  0,  0,  0,  0,
    0, 28, 30,  0, 34,  0, 35,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0, 38,  0,  0,  0, 45,
    0,  0,  0,  0,  0,  0,  0, 39,  0,  0, 45,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$Mexpa = drop0(matrix(c(
    0,  9,  5,  0,  8, 28,  0,  0, 22, 23,  0,  0,
    9,  0, 16,  0, 20, 19,  0,  0, 23, 24, 28,  0,
    5, 16,  0, 23, 31, 37,  0, 28,  0,  0, 30,  0,
    0,  0, 23,  0,  0, 27,  0, 29,  0,  0,  0,  0,
    8, 20, 31,  0,  0, 14,  0,  0,  0,  0, 34,  0,
   28, 19, 37, 27, 14,  0,  0, 32, 32, 33,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 28, 29,  0, 32,  0,  0,  0,  0,  0,  0,
   22, 23,  0,  0,  0, 32,  0,  0,  0, 37,  0,  0,
   23, 24,  0,  0,  0, 33,  0,  0, 37,  0,  0,  0,
    0, 28, 30,  0, 34,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "mean", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "mean", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "mean", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "mean", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

test_that("build_motif_adjacency_matrix returns correct mean-weighted structural matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  2,  0,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 12,  0,  0,  0,  0,  0,
    4,  0,  0,  0,  0,  0,  0,  0, 18, 19,  0,  0,
    0,  0,  0,  0,  0,  0, 15,  0,  0, 20, 21,  0,
    0,  0, 11, 12,  0, 15,  0,  0,  0,  0, 22, 23,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 18,  0,  0,  0,  0, 24,  0,  0,
    0,  0,  0,  0, 19, 20,  0,  0, 24,  0,  0,  0,
    0,  0,  0,  0,  0, 21, 22,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 23,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 19,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 11,  0,  0,  0, 27,  0,  0,  0,  0,  0,  0,
    0, 15, 19,  0, 27,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 33,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 58,  0,  0,  0, 58,  0,
    0,  0,  0,  0,  0, 58,  0,  0,  0,  0, 58,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 58, 58,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 66,  0,  0,  0, 66,  0,  0,
    0,  0,  0,  0, 66,  0,  0,  0,  0, 66,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 66, 66,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 37,  0,  0, 37,  0,  0,  0,  0,  0,  0,
    0, 37,  0,  0,  0, 37,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 37, 37,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 5

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 53, 53,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0,  0, 53,  0,  0,  0,  0,  0,  0,
    0, 53,  0,  0, 53,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 6

  ans$M5 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0, 61, 61,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 61,  0,  0,  0,  0, 61,  0,  0,
    0,  0,  0,  0, 61,  0,  0,  0, 61,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 45, 45,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 45,  0,  0,  0, 45,  0,  0,  0,  0,  0,
    0,  0, 45,  0,  0, 45,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M7 = drop0(matrix(c(
    0, 17,  0,  0, 17,  0,  0,  0,  0,  0,  0,  0,
   17,  0,  0,  0, 17,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   17, 17,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$M8 = drop0(matrix(c(
    0,  5,  5,  0, 45,  0,  0,  0, 22, 23,  0,  0,
    5,  0,  5,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    5,  5,  0, 23,  0,  0, 23,  0,  0,  0,  0,  0,
    0,  0, 23,  0,  0, 27, 50,  0,  0,  0,  0,  0,
   45,  0,  0,  0,  0,  0,  0,  0, 22, 23,  0,  0,
    0,  0,  0, 27,  0,  0, 27,  0,  0,  0,  0,  0,
    0,  0, 23, 50,  0, 27,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   22,  0,  0,  0, 22,  0,  0,  0,  0,  0,  0,  0,
   23,  0,  0,  0, 23,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M9 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 67,  0,  0,  0, 33, 34,
    0,  0,  0,  0,  0,  0, 69,  0,  0,  0, 34, 35,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 38,  0, 44, 85, 41, 38,
    0,  0, 67, 69,  0, 38,  0,  0,  0,  0, 67,107,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 44,  0,  0,  0, 44,  0,  0,
    0,  0,  0,  0,  0, 85,  0,  0, 44,  0, 41,  0,
    0,  0, 33, 34,  0, 41, 67,  0,  0, 41,  0,  0,
    0,  0, 34, 35,  0, 38,107,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M10 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 14,  0,  0,  0, 14,  0,  0,  0,  0,  0,
    0, 14,  0,  0,  0,  0, 14,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 35,  0,  0, 35,  0,  0,
    0, 14, 14,  0,  0, 35,  0,  0,  0, 35, 45, 45,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 35, 35,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 45,  0,  0,  0,  0, 45,
    0,  0,  0,  0,  0,  0, 45,  0,  0,  0, 45,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$M11 = drop0(matrix(c(
    0, 17,  0,  0, 31, 48,  0,  0,  0,  0,  0,  0,
   17,  0, 14,  0, 73, 53,  0,  0, 29, 30, 36,  0,
    0, 14,  0,  0, 14, 40, 44, 44,  0,  0, 40,  0,
    0,  0,  0,  0,  0,  0, 45, 45,  0,  0,  0,  0,
   31, 73, 14,  0,  0,124,  0,  0, 74, 30, 48,  0,
   48, 53, 40,  0,124,  0, 48, 48, 45,  0,124,  0,
    0,  0, 44, 45,  0, 48,  0,137,  0,  0,  0,  0,
    0,  0, 44, 45,  0, 48,137,  0,  0,  0,  0,  0,
    0, 29,  0,  0, 74, 45,  0,  0,  0,  0,  0,  0,
    0, 30,  0,  0, 30,  0,  0,  0,  0,  0,  0,  0,
    0, 36, 40,  0, 48, 124,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 65, 30,  0,  0, 35,  0,  0,
    0,  0,  0,  0,  0, 39,  0,  0,  0, 39,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0, 42, 42,  0,  0,  0,  0,  0,
    0, 65, 39,  0, 42,  0, 72,  0,  0, 74,  0,  0,
    0, 30,  0,  0, 42, 72,  0,111,  0,  0, 55, 56,
    0,  0,  0,  0,  0,  0,111,  0,  0,  0, 55, 56,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 35, 39,  0,  0, 74,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 55, 55,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 56, 56,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 3

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 46, 46,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0, 46,  0,  0, 46,  0,  0,  0,  0,  0,  0,
    0,  0, 46,  0, 46,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 4

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 14,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0, 14,  0,  0,  0,  0,  0,  0,  0, 35,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 35,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 45,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 45,  0
  ), nrow=12, byrow=TRUE)) / 2

  ans$Mexpa = drop0(matrix(c(
    0,  0,  5,  0,  0,  0,  0,  0, 22, 23,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    5,  0,  0, 23,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  23,  0,  0, 27,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0, 27,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   22,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
   23,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE)) / 2

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:length(motifs)){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "mean", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "mean", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "struc", "mean", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "struc", "mean", "sparse")

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_densemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_densemethod", motifs[i]))
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_densematrix_sparsemethod", motifs[i]))
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]], label=paste("MAM_sparsematrix_sparsemethod", motifs[i]))
  }

})

test_that("build_motif_adjacency_matrix returns correct product-weighted functional matrix", {

  # test case
  adj_mat_dense = demonstration_graph()$adj_mat_dense
  adj_mat_sparse = demonstration_graph()$adj_mat_sparse

  # correct answers
  ans = list()

  ans$Ms = drop0(matrix(c(
    0,  2,  0,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0, 11, 15,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0, 19, 11,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 12,  0,  0,  0,  0,  0,
    4, 11,  0,  0,  0, 27,  0,  0, 18, 19,  0,  0,
    0, 15, 19,  0, 27,  0, 15,  0,  0, 20, 21,  0,
    0,  0, 11, 12,  0, 15,  0, 33,  0,  0, 22, 23,
    0,  0,  0,  0,  0,  0,  33,  0,  0,  0,  0,  0,
    0,  0,  0,  0, 18,  0,  0,  0,  0, 24,  0,  0,
    0,  0,  0,  0, 19, 20,  0,  0, 24,  0,  0,  0,
    0,  0,  0,  0,  0, 21, 22,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0, 23,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Md = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M1 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  3,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  3,  0,  0,  0,  1,  0,  0,
    0,  3,  1,  0,  3,  0,  1,  0,  0,  1,  1,  0,
    0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M2 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  2,  0,  6,  8,  0,  0,  0,  0,  0,  0,
    0,  2,  0,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  7,  0,  0,  0,  1,  0,  0,
    0,  8,  2,  0,  7,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M3 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  6,  7,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  0,  0,  0,  6,  0,  0,  0,  0,  0,  0,
    0,  7,  1,  0,  6,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M4 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M5 = drop0(matrix(c(
    0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,  0,
    2,  0,  3,  0,  8,  9,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  5,  2,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    2,  8,  0,  0,  0,  7,  0,  0,  1,  2,  0,  0,
    0,  9,  5,  0,  7,  0,  2,  0,  0,  1,  0,  0,
    0,  0,  2,  0,  0,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  2,  1,  0,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M6 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  2,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  3,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M7 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  1,  0,  4,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  0,  0,  0,  3,  0,  0,  0,  0,  0,  0,
    0,  4,  1,  0,  3,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M8 = drop0(matrix(c(
    0,  4,  1,  0,  5,  2,  0,  0,  1,  1,  0,  0,
    4,  0,  4,  0,  8,  7,  0,  0,  1,  1,  1,  0,
    1,  4,  0,  1,  2,  5,  3,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  3,  1,  0,  0,  0,  0,
    5,  8,  2,  0,  0,  8,  0,  0,  4,  4,  1,  0,
    2,  7,  5,  1,  8,  0,  3,  1,  1,  1,  3,  0,
    0,  0,  3,  3,  0,  3,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  4,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M9 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  5,  0, 11, 14,  1,  0,  1,  2,  1,  0,
    0,  5,  0,  0,  3, 10,  5,  1,  0,  1,  2,  1,
    0,  0,  0,  0,  0,  0,  3,  1,  0,  0,  1,  1,
    3, 11,  3,  0,  0, 15,  1,  0,  3,  5,  1,  0,
    2, 14, 10,  0, 15,  0,  9,  1,  2,  7,  7,  1,
    0,  1,  5,  3,  1,  9,  0,  5,  0,  0,  6,  4,
    0,  0,  1,  1,  0,  1,  5,  0,  0,  0,  1,  1,
    0,  1,  0,  0,  3,  2,  0,  0,  0,  2,  0,  0,
    0,  2,  1,  0,  5,  7,  0,  0,  2,  0,  1,  0,
    0,  1,  2,  1,  1,  7,  6,  1,  0,  1,  0,  0,
    0,  0,  1,  1,  0,  1,  4,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M10 = drop0(matrix(c(
    0,  1,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    1,  0,  3,  0,  4,  7,  2,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  1,  6,  3,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    1,  4,  1,  0,  0,  6,  1,  0,  1,  2,  0,  0,
    0,  7,  6,  0,  6,  0,  5,  0,  0,  4,  0,  0,
    0,  2,  3,  0,  1,  5,  0,  2,  0,  1,  2,  2,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  0,  0,
    0,  1,  1,  0,  2,  4,  1,  0,  1,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  2,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$M11 = drop0(matrix(c(
    0,  3,  0,  0,  3,  2,  0,  0,  0,  0,  0,  0,
    3,  0,  4,  0, 11, 11,  0,  0,  1,  1,  1,  0,
    0,  4,  0,  0,  3,  6,  1,  1,  0,  0,  1,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    3, 11,  3,  0,  0, 12,  0,  0,  2,  2,  1,  0,
    2, 11,  6,  0, 12,  0,  1,  1,  1,  1,  3,  0,
    0,  0,  1,  1,  0,  1,  0,  3,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  2,  1,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M12 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  3,  0,  6, 11,  1,  0,  0,  1,  0,  0,
    0,  3,  0,  0,  2,  8,  2,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  6,  2,  0,  0, 10,  1,  0,  0,  1,  0,  0,
    0, 11,  8,  0, 10,  0,  4,  0,  0,  3,  0,  0,
    0,  1,  2,  0,  1,  4,  0,  2,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  2,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  3,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$M13 = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  3,  4,  0,  0,  0,  0,  0,  0,
    0,  1,  0,  0,  1,  2,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  3,  1,  0,  0,  4,  0,  0,  0,  0,  0,  0,
    0,  4,  2,  0,  4,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  ans$Mcoll = drop0(matrix(c(
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  0,  2,  2,  2,  0,  0,  1,  0,  0,
    0,  1,  0,  0,  1,  0,  1,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  0,  1,  1,  0,  1,  1,  0,  0,
    0,  2,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  2,  1,  0,  1,  1,  0,  0,  0,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,
    0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  1,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,
    0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  0
  ), nrow=12, byrow=TRUE))

  ans$Mexpa = drop0(matrix(c(
    0,  1,  1,  0,  1,  2,  0,  0,  1,  1,  0,  0,
    1,  0,  1,  0,  1,  1,  0,  0,  1,  1,  1,  0,
    1,  1,  0,  1,  2,  2,  0,  1,  0,  0,  1,  0,
    0,  0,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0,
    1,  1,  2,  0,  0,  1,  0,  0,  0,  0,  1,  0,
    2,  1,  2,  1,  1,  0,  0,  1,  1,  1,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  0,  1,  0,  0,
    1,  1,  0,  0,  0,  1,  0,  0,  1,  0,  0,  0,
    0,  1,  1,  0,  1,  0,  0,  0,  0,  0,  0,  0,
    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0
  ), nrow=12, byrow=TRUE))

  # compare calculations with answers
  motifs = get_motif_names()
  #for(i in 1:length(motifs)){
  for(i in 1){

    MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_dense, motifs[i], "func", "product", "dense")
    MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      adj_mat_sparse, motifs[i], "func", "product", "dense")
    #MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      #adj_mat_dense, motifs[i], "func", "product", "sparse")
    #MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      #adj_mat_sparse, motifs[i], "func", "product", "sparse")

    print(motifs[i])
    print(MAM_densematrix_densemethod)
    #print(MAM_densematrix_sparsemethod)
    print(ans[[motifs[i]]])

    expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    #expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    #expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

# get_largest_component

test_that("get_largest_component returns correct indices", {

  adj_mat_dense = matrix(c(
    0,0,0,0,0,
    0,0,1,0,0,
    0,0,0,0,2,
    3,0,0,0,0,
    0,4,0,0,0
  ), nrow=5, byrow=TRUE)
  adj_mat_sparse = drop0(adj_mat_dense)

  ans = c(2,3,5)

  expect_equal(get_largest_component(adj_mat_dense), ans)
  expect_equal(get_largest_component(adj_mat_sparse), ans)
})

# drop0_killdiag

test_that("drop0_killdiag returns correct matrix", {

  adj_mat_dense = matrix(-1:7, nrow=3)
  adj_mat_sparse = drop0(adj_mat_dense)

  ans = drop0(matrix(c(0,0,1,2,0,4,5,6,0), nrow=3))

  expect_equal(drop0_killdiag(adj_mat_dense), ans)
  expect_equal(drop0_killdiag(adj_mat_sparse), ans)
})
