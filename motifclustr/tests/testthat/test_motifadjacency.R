context("Motif adjacency")

library(Matrix)

# build_motif_adjacency_matrix
# test against igraph too?

test_that("build_motif_adjacency_matrix returns correct unweighted functional matrix", {

  # test case
  G_dense = matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    2, 0, 3, 0, 6, 8, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0,10, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    4, 5, 0, 0, 0,14, 0, 0,18,19, 0, 0,
    0, 7, 9, 0,13, 0, 0, 0, 0, 0,21, 0,
    0, 0,11,12, 0,15, 0,17, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0,16, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0,24, 0, 0,
    0, 0, 0, 0, 0,20, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0,22, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0,23, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)
  G_sparse = unname(drop0(G_dense))

  # correct answers
  ans = list()

  ans$Ms = unname(drop0(matrix(c(
    0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    1, 0, 1, 0, 2, 2, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
    1, 2, 0, 0, 0, 2, 0, 0, 1, 1, 0, 0,
    0, 2, 2, 0, 2, 0, 1, 0, 0, 1, 1, 0,
    0, 0, 1, 1, 0, 1, 0, 2, 0, 0, 1, 1,
    0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$Md = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M1 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 2, 3, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 2, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0,
    0, 3, 1, 0, 3, 0, 1, 0, 0, 1, 1, 0,
    0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M2 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 2, 0, 6, 8, 0, 0, 0, 0, 0, 0,
    0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 6, 0, 0, 0, 7, 0, 0, 0, 1, 0, 0,
    0, 8, 2, 0, 7, 0, 0, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M3 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 6, 7, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 6, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0,
    0, 7, 1, 0, 6, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M4 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M5 = unname(drop0(matrix(c(
    0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0,
    2, 0, 3, 0, 8, 9, 0, 0, 0, 0, 0, 0,
    0, 3, 0, 0, 0, 5, 2, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    2, 8, 0, 0, 0, 7, 0, 0, 1, 2, 0, 0,
    0, 9, 5, 0, 7, 0, 2, 0, 0, 1, 0, 0,
    0, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 2, 1, 0, 0, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M6 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 3, 4, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 3, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0,
    0, 4, 2, 0, 3, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M7 = unname(drop0(matrix(c(
    0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    1, 0, 1, 0, 4, 4, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    1, 4, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0,
    0, 4, 1, 0, 3, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M8 = unname(drop0(matrix(c(
    0, 4, 1, 0, 5, 2, 0, 0, 1, 1, 0, 0,
    4, 0, 4, 0, 8, 7, 0, 0, 1, 1, 1, 0,
    1, 4, 0, 1, 2, 5, 3, 1, 0, 0, 1, 0,
    0, 0, 1, 0, 0, 1, 3, 1, 0, 0, 0, 0,
    5, 8, 2, 0, 0, 8, 0, 0, 4, 4, 1, 0,
    2, 7, 5, 1, 8, 0, 3, 1, 1, 1, 3, 0,
    0, 0, 3, 3, 0, 3, 0, 3, 0, 0, 0, 0,
    0, 0, 1, 1, 0, 1, 3, 0, 0, 0, 0, 0,
    1, 1, 0, 0, 4, 1, 0, 0, 0, 1, 0, 0,
    1, 1, 0, 0, 4, 1, 0, 0, 1, 0, 0, 0,
    0, 1, 1, 0, 1, 3, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M9 = unname(drop0(matrix(c(
    0, 3, 0, 0, 3, 2, 0, 0, 0, 0, 0, 0,
    3, 0, 5, 0,11,14, 1, 0, 1, 2, 1, 0,
    0, 5, 0, 0, 3,10, 5, 1, 0, 1, 2, 1,
    0, 0, 0, 0, 0, 0, 3, 1, 0, 0, 1, 1,
    3,11, 3, 0, 0,15, 1, 0, 3, 5, 1, 0,
    2,14,10, 0,15, 0, 9, 1, 2, 7, 7, 1,
    0, 1, 5, 3, 1, 9, 0, 5, 0, 0, 6, 4,
    0, 0, 1, 1, 0, 1, 5, 0, 0, 0, 1, 1,
    0, 1, 0, 0, 3, 2, 0, 0, 0, 2, 0, 0,
    0, 2, 1, 0, 5, 7, 0, 0, 2, 0, 1, 0,
    0, 1, 2, 1, 1, 7, 6, 1, 0, 1, 0, 0,
    0, 0, 1, 1, 0, 1, 4, 1, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M10 = unname(drop0(matrix(c(
    0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    1, 0, 3, 0, 4, 7, 2, 0, 0, 1, 0, 0,
    0, 3, 0, 0, 1, 6, 3, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    1, 4, 1, 0, 0, 6, 1, 0, 1, 2, 0, 0,
    0, 7, 6, 0, 6, 0, 5, 0, 0, 4, 0, 0,
    0, 2, 3, 0, 1, 5, 0, 2, 0, 1, 2, 2,
    0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 1, 1,
    0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0,
    0, 1, 1, 0, 2, 4, 1, 0, 1, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 1,
    0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 1, 0
  ), nrow=12, byrow=TRUE)))

  ans$M11 = unname(drop0(matrix(c(
    0, 3, 0, 0, 3, 2, 0, 0, 0, 0, 0, 0,
    3, 0, 4, 0,11,11, 0, 0, 1, 1, 1, 0,
    0, 4, 0, 0, 3, 6, 1, 1, 0, 0, 1, 0,
    0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
    3,11, 3, 0, 0,12, 0, 0, 2, 2, 1, 0,
    2,11, 6, 0,12, 0, 1, 1, 1, 1, 3, 0,
    0, 0, 1, 1, 0, 1, 0, 3, 0, 0, 0, 0,
    0, 0, 1, 1, 0, 1, 3, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 0, 1, 3, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M12 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 3, 0, 6,11, 1, 0, 0, 1, 0, 0,
    0, 3, 0, 0, 2, 8, 2, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 6, 2, 0, 0,10, 1, 0, 0, 1, 0, 0,
    0,11, 8, 0,10, 0, 4, 0, 0, 3, 0, 0,
    0, 1, 2, 0, 1, 4, 0, 2, 0, 0, 1, 1,
    0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 1, 1,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 0, 1, 3, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$M13 = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 3, 4, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 3, 1, 0, 0, 4, 0, 0, 0, 0, 0, 0,
    0, 4, 2, 0, 4, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  ans$coll = unname(drop0(matrix(c(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 2, 2, 2, 0, 0, 1, 0, 0,
    0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 2, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0,
    0, 2, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0,
    0, 2, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1,
    0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1,
    0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0
  ), nrow=12, byrow=TRUE)))

  ans$expa = unname(drop0(matrix(c(
    0, 1, 1, 0, 1, 2, 0, 0, 1, 1, 0, 0,
    1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0,
    1, 1, 0, 1, 2, 2, 0, 1, 0, 0, 1, 0,
    0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0,
    1, 1, 2, 0, 0, 1, 0, 0, 0, 0, 1, 0,
    2, 1, 2, 1, 1, 0, 0, 1, 1, 1, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0,
    1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0,
    1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0,
    0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
  ), nrow=12, byrow=TRUE)))

  # compare calculations with answers
  motifs = get_motif_names()
  for(i in 1:11){
  #for(i in 1:length(motifs)){

    #MAM_densematrix_densemethod = build_motif_adjacency_matrix(
      #G_dense, motifs[i], "func", "unweighted", "dense")
    #MAM_sparsematrix_densemethod = build_motif_adjacency_matrix(
      #G_sparse, motifs[i], "func", "unweighted", "dense")
    MAM_densematrix_sparsemethod = build_motif_adjacency_matrix(
      G_dense, motifs[i], "func", "unweighted", "sparse")
    MAM_sparsematrix_sparsemethod = build_motif_adjacency_matrix(
      G_sparse, motifs[i], "func", "unweighted", "sparse")

    #print(motifs[i])
    #print(MAM_densematrix_sparsemethod)
    #print(ans[[motifs[i]]])

    #expect_equal(MAM_densematrix_densemethod, ans[[motifs[i]]])
    #expect_equal(MAM_sparsematrix_densemethod, ans[[motifs[i]]])
    expect_equal(MAM_densematrix_sparsemethod, ans[[motifs[i]]])
    expect_equal(MAM_sparsematrix_sparsemethod, ans[[motifs[i]]])
  }

})

# get_largest_component

test_that("get_largest_component returns correct indices", {

  G_dense = matrix(c(
    0,0,0,0,0,
    0,0,1,0,0,
    0,0,0,0,2,
    3,0,0,0,0,
    0,4,0,0,0
  ), nrow=5, byrow=TRUE)
  G_sparse = drop0(G_dense)

  ans = c(2,3,5)

  expect_equal(get_largest_component(G_dense), ans)
  expect_equal(get_largest_component(G_sparse), ans)
})

# drop0_killdiag

test_that("drop0_killdiag returns correct matrix", {

  G_dense = matrix(-1:7, nrow=3)
  G_sparse = drop0(G_dense)

  ans = drop0(matrix(c(0,0,1,2,0,4,5,6,0), nrow=3))

  expect_equal(drop0_killdiag(G_dense), ans)
  expect_equal(drop0_killdiag(G_sparse), ans)
})
